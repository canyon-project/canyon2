{
  "data": "aW1wb3J0IHtGbGlnaHRCb29rQmFzZUluZm8sIEZsaWdodEJvb2tQYWdlSW5wdXRQYXJhbXMsIFJlcXVlc3RTdGF0dXN9IGZyb20gJy4uL2Jhc2UvTW9kZWwnOwppbXBvcnQgewogIEJPT0tfUEFHRV9BUFBST1ZBTF9QQVNTRU5HRVIsCiAgQk9PS19QQUdFX0FQUFJPVkFMX1VQREFURSwKICBCT09LX1BBR0VfUE9TVEFQUFJPVkFMX1VQREFURSwKICBCT09LX1BBR0VfUE9TVFBPTkVfVVBEQVRFLAogIEJPT0tfUEFHRV9TVUJNSVQsCiAgQk9PS19QQUdFX1RSQVZFTF9VUERBVEUsCiAgRkxJR0hUX0JPT0tfQkFTRV9JTkZPX01PREVMLAogIEZMSUdIVF9CT09LX0JBU0VfSU5QVVRfTU9ERUwsCn0gZnJvbSAnLi4vY29tbW9uJzsKaW1wb3J0IHtJQXBwbGljYXRpb25JdGVtLCBJUG9zdEFwcHJvdmFsVHJhdmVsQXBwbGljYXRpb25JdGVtLCBJVHJhdmVsUmVsYXRlZERhdGF9IGZyb20gJy4uL2ludGVyZmFjZSc7CmltcG9ydCB7U3VibWl0UmFua0lkfSBmcm9tICcuLi9zdWJtaXQnOwppbXBvcnQgewogIEJPT0tfUEFHRV9OQU1FLAogIEJvb2tpbmdOb25FbXBsb3llZUVudW0sCiAgRkxJR0hUX0JPT0tfREVWX0xPR19UUkFDRV9LRVlTLAogIEZMSUdIVF9CT09LX1NIQVJLLAogIFBST0RVQ1RfTElORSwKICBQUk9EVUNUX05BTUUsCiAgVF9PUl9GLAp9IGZyb20gJ0AvY29uc3RhbnRzJzsKaW1wb3J0IHt5bWRGdWxsU3RyaW5nfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IHt1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VTdGF0ZX0gZnJvbSAncmVhY3QnOwoKaW1wb3J0IHtpc0NhbmNlbH0gZnJvbSAnQGN0cmlwL2NvcnAtY3Jvc3MtcmVxdWVzdCc7CmltcG9ydCB7RGV2VHJhY2UsIGdldEFsbFF1ZXJ5LCBnZXRDb29raWUsIGdldFNoYXJrVmFsdWUsIFRyYWNlVHJ5Q2F0Y2h9IGZyb20gJ0BjdHJpcC9jb3JwLWNyb3NzLXV0aWxzJzsKaW1wb3J0IHtQQVlNRU5UX1dBWV9FVkVOVH0gZnJvbSAnQGN0cmlwL2NvcnAtZmxpZ2h0LWJ1c2luZXNzLWg1LWRlbGl2ZXJ5L2Rpc3QvZXNtL2NvbnN0YW50cyc7CmltcG9ydCB7UGF5VHlwZVJlbGF0aW9uTGlzdFYyfSBmcm9tICdAY3RyaXAvY29ycC1nYXRld2F5LWNvcnBmbGlnaHRib29rc2VydmljZS9kaXN0L2VzbS9kZWxpdmVyeURldGFpbHNWMi9pbnRlcmZhY2UnOwppbXBvcnQgewogIFJlY2FsY3VsYXRlQ29udHJvbE1peFBheW1lbnRJbmZvLAogIHJlY2FsY3VsYXRlQ29udHJvbFJlcXVlc3QsCiAgUmVjYWxjdWxhdGVDb250cm9sUmVxdWVzdFR5cGUsCn0gZnJvbSAnQGN0cmlwL2NvcnAtZ2F0ZXdheS1jb3JwZmxpZ2h0Ym9va3NlcnZpY2U0ai9kaXN0L2VzbS9yZWNhbGN1bGF0ZUNvbnRyb2wnOwppbXBvcnQge3NlYXJjaEFwcHJvdmFsTGlzdH0gZnJvbSAnQGN0cmlwL2NvcnAtZ2F0ZXdheS1jb3JwZnJvbnRlbmRiYXNpY2NvbW1vbi9kaXN0L2VzbS9zZWFyY2hBcHByb3ZhbExpc3QnOwppbXBvcnQgewogIGdldFRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsLAogIEdldFRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsUmVxdWVzdFR5cGUsCn0gZnJvbSAnQGN0cmlwL2NvcnAtZ2F0ZXdheS1ub2RlY29tbW9uYnVzaW5lc3N0cmF2ZWwvZGlzdC9lc20vZ2V0VHJhdmVsQXBwbGljYXRpb25EZXRhaWwnOwppbXBvcnQgewogIGdldFRyYXZlbEFwcGxpY2F0aW9uTGlzdCwKICBHZXRUcmF2ZWxBcHBsaWNhdGlvbkxpc3RSZXF1ZXN0VHlwZSwKfSBmcm9tICdAY3RyaXAvY29ycC1nYXRld2F5LW5vZGVjb21tb25idXNpbmVzc3RyYXZlbC9kaXN0L2VzbS9nZXRUcmF2ZWxBcHBsaWNhdGlvbkxpc3QnOwppbXBvcnQge2dldEVhcmllckFwcHJvdmV9IGZyb20gJ0BjdHJpcC9jb3JwLWdhdGV3YXktbm9kZWNvbW1vbmVhcmllcmFwcHJvdmUvZGlzdC9lc20vZ2V0RWFyaWVyQXBwcm92ZSc7CmltcG9ydCB7dXNlQWRkTGlzdGVuZXIsIHVzZUVtaXQsIHVzZUhhbmRsZUV2ZW50UmVxdWVzdCwgdXNlU3Vic2NyaWJlTW9kZWx9IGZyb20gJ0BjdHJpcC9jb3JwaG9va3MnOwoKLyoqCiAqICAxOiDph5Hpop3nlLPor7cgMjog5LqL55Sx55Sz6K+3CiAqLwpleHBvcnQgdHlwZSBJRW5kb3JzZW1lbnQgPSAxIHwgMjsKaW50ZXJmYWNlIElQcm9wcyB7CiAgYW5jaG9ySGFuZGxlcjogKCkgPT4gdm9pZDsKfQoKZXhwb3J0IGVudW0gRU9hVHlwZSB7CiAgZG9tZXN0aWMgPSAnMScsCiAgaW50ZXJuYXRpb25hbCA9ICcyJywKfQoKZXhwb3J0IGZ1bmN0aW9uIHVzZVBvc3RBcHByb3ZhbEFuZFRyYXZlbEFwcGxpY2F0aW9uSG9va3MocGFyYW1zOiBJUHJvcHMpIHsKICBjb25zdCBiYXNlSW5mb0RhdGEgPSB1c2VTdWJzY3JpYmVNb2RlbDxGbGlnaHRCb29rQmFzZUluZm8+KEZMSUdIVF9CT09LX0JBU0VfSU5GT19NT0RFTCk7CiAgY29uc3QgYmFzZUlucHV0RGF0YSA9IHVzZVN1YnNjcmliZU1vZGVsPEZsaWdodEJvb2tQYWdlSW5wdXRQYXJhbXM+KEZMSUdIVF9CT09LX0JBU0VfSU5QVVRfTU9ERUwpOwogIGNvbnN0IHtpc0ludGwsIHBJZH0gPSBiYXNlSW5wdXREYXRhIHx8IHt9OwogIGNvbnN0IHsKICAgIHVuaXF1ZUtleSwKICAgIGlzRW1lcmdlbmN5LAogICAgdGFPcmRlck5vLAogICAgdGFUcmF2ZWxQbGFuTm8sCiAgICByZXF1ZXN0U3RhdHVzLAogICAgdHJpcEFwcGx5LAogICAgYWR2YW5jZUFwcHJvdmUsCiAgICBwcmVBZHZhbmNlQXBwcm92ZSwKICAgIG11bHRpQXBwcm92YWxNb2RlLAogICAgb3BlblJvdXRlLAogICAgc3dpdGNoTWFwLAogICAgcHJlQXBwcm92ZVBlcnNvbiwKICAgIGFwcHJvdmFsTWl4UGF5U3dpdGNoLAogICAgZW1lcmdlbmN5TmFtZSwKICAgIGFwcHJvdmFsTGlzdFRpdGxlLAogICAgc3dpdGNoQXBwcm92YWxQYXNzZW5nZXJDbGVhciwKICAgIC8qKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgYXBwcm92YWxObywKICAgIC8qKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgYXBwcm92YWxNYWluTm8sCiAgICAvKioKICAgICAqIOWJjeWQjue9ruWuoeaJuem7mOiupOS4u+WNleWPtwogICAgICovCiAgICBkZWZhdWx0QXBwcm92YWxNYWluTm8sCiAgICAvKioKICAgICAqIOWJjeWQjue9ruWuoeaJuem7mOiupOWtkOWNleWPtwogICAgICovCiAgICBkZWZhdWx0QXBwcm92YWxObywKICAgIGJvb2tGb3JFbXBsb3llZUNvbnRyb2xDb2RlLAogIH0gPSBiYXNlSW5mb0RhdGEgfHwge307CgogIGNvbnN0IHBsZWFzZVNlbGVjdFRleHQgPSBnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLnRyYXZlbEFwcGxpY2F0aW9uRm9ybUl0ZW1QbGFjZWhvbGRlcik7CiAgLy8g5YW85a656ICB5a2X5q61CiAgY29uc3QgaXNNaWNlID0gYmFzZUluZm9EYXRhPy5taWNlRmxhZzsKICAvLyBpbml05bey6YCJ5pWw5o2uIHx8IOWHuuW3rueUs+ivt+W3suWFs+iBlOWNleaNruWIneWni+WMlgogIGNvbnN0IGluaXRTZWxlY3RlZEl0ZW0gPSB7CiAgICBubzogJycsCiAgICBuYW1lOiAnJywKICAgIG1haW5ObzogJycsCiAgICB0cmF2ZWxMaXN0OiBbXSwKICB9OwogIC8vIOaUr+S7mOaWueW8jwogIGNvbnN0IFtwYXlUeXBlLCBzZXRQYXlUeXBlXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+KCcnKTsKICAvLyDlm73pmYXmmoLnvJMKICBjb25zdCBbcG9zdHBvbmUsIHNldFBvc3Rwb25lXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKTsKICAvLyDliJfooajmta7lsYLmmK/lkKblj6/op4EKICBjb25zdCBbbGlzdFBvcHVwVmlzaWJsZSwgc2V0TGlzdFBvcHVwVmlzaWJsZV0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7CiAgLy8g5piv5ZCm5bey6YCJ5oup57Sn5oCl6aKE5a6aCiAgY29uc3QgW3NlbGVjdGVkRW1lcmdlbmN5LCBzZXRTZWxlY3RlZEVtZXJnZW5jeV0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7CiAgLy8g5bey6YCJ5oup55qEaXRlbQogIGNvbnN0IFtzZWxlY3RlZEl0ZW0sIHNldFNlbGVjdGVkSXRlbV0gPSB1c2VTdGF0ZTxJUG9zdEFwcHJvdmFsVHJhdmVsQXBwbGljYXRpb25JdGVtPihpbml0U2VsZWN0ZWRJdGVtKTsKICAvLyDmt7fku5jmjqXlj6Pov5Tlm57nmoTlgLwKICBjb25zdCBbbWl4UGF5SW5mbywgc2V0TWl4UGF5SW5mb10gPSB1c2VTdGF0ZTxSZWNhbGN1bGF0ZUNvbnRyb2xNaXhQYXltZW50SW5mbz4obnVsbCk7CiAgLy8g5Ye65beu55Sz6K+35YWz6IGU55qE6K+m5oOF5aSW5pi+5pWw5o2uCiAgY29uc3QgW3JlbGF0ZWRUcmF2ZWxBcHBsaWNhdGlvbiwgc2V0UmVsYXRlZFRyYXZlbEFwcGxpY2F0aW9uXSA9CiAgICB1c2VTdGF0ZTxJUG9zdEFwcHJvdmFsVHJhdmVsQXBwbGljYXRpb25JdGVtPihpbml0U2VsZWN0ZWRJdGVtKTsKICAvLyDlh7rlt67nlLPor7fnsbvlnosKICBjb25zdCBbZW5kb3JzZW1lbnRUeXBlLCBzZXRFbmRvcnNlbWVudFR5cGVdID0gdXNlU3RhdGU8SUVuZG9yc2VtZW50PigpOwogIC8vIOihjOeoi+WFs+iBlOeahOWHuuW3rueUs+ivt+aVsOaNrgogIGNvbnN0IFt0cmF2ZWxSZWxhdGVkRGF0YSwgc2V0VHJhdmVsUmVsYXRlZERhdGFdID0gdXNlU3RhdGU8SVRyYXZlbFJlbGF0ZWREYXRhPihudWxsKTsKICAvLyDmmK/lkKblj6/kv67mlLkKICBjb25zdCBbY2FuTW9kaWZ5LCBzZXRDYW5Nb2RpZnldID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpOwogIC8vIOWHuuW3rueUs+ivt+WIl+ihqOaVsOaNrgogIGNvbnN0IFt0cmF2ZWxMaXN0RGF0YSwgc2V0VHJhdmVsTGlzdERhdGFdID0gdXNlU3RhdGUobnVsbCk7CiAgLy8g57uZ57uE5Lu25Lyg55qE6buY6K6k5Li75Y2V5Y+377yM57uE5Lu25Lya5qC55o2u5Li75Y2V5Y+35p+l6K+i5a+55bqU55qE5a2Q5Y2V5Y+35YiX6KGoCiAgLy8g5LiN6IO96LWL5YC857uZc2VsZWN0ZWRJdGVtLm1haW5Ob+aYr+WboOS4unNlbGVjdGVkSXRlbS5tYWluTm/kuLrkuIvljZXlj4LmlbAKICBjb25zdCBbc2VhcmNoQXBwcm92YWxOb0xpc3QsIHNldFNlYXJjaEFwcHJvdmFsTm9MaXN0XSA9IHVzZVN0YXRlPHN0cmluZ1tdPihbXSk7CiAgLy8g5pyq6YCJ5oup5o+Q56S66K+d5pyvCiAgY29uc3QgW25vU2VsZWN0ZWRUaXAsIHNldE5vU2VsZWN0ZWRUaXBdID0gdXNlU3RhdGU8c3RyaW5nPignJyk7CgogIC8vIOWuoeaJueWQjue9rumAieaLqeWuoeaJueWNleS5i+WQjuabtOaWsCBtaXhQYXlLZXkg5Y+R6YCB5LqL5Lu277yM5Y+C5pWw5Y+C6ICD5o6l5Y+jaW50ZXJmYWNlIFJlY2FsY3VsYXRlQ29udHJvbE1peFBheW1lbnRJbmZvCiAgY29uc3QgbWl4UGF5S2V5RW1pdCA9IHVzZUVtaXQoQk9PS19QQUdFX1BPU1RBUFBST1ZBTF9VUERBVEUpOwogIC8vIOaPkOWJjeWuoeaJueaIluWuoeaJueWQjue9ruWNleWPt+aIlue0p+aApemihOWumuabtOaWsCDlj5HpgIHkuovku7bvvIzlj4LmlbDmmK8ge2FwcHJvdmFsTm8sIGlzRW1lcmdlbmN5fQogIGNvbnN0IGFwcHJvdmFsRW1pdCA9IHVzZUVtaXQoQk9PS19QQUdFX0FQUFJPVkFMX1VQREFURSk7CiAgLy8g5o+Q5YmN5a6h5om55ZCO572u5pe277yM6YCJ5oup5LqG5a6h5om55Y2V5ZCO5Y+R5LqL5Lu257uZ5LmY5py65Lq65qih5Z2X77yM5ZGK55+l5piv5ZCm5piv57Sn5oCl6aKE5a6aCiAgY29uc3QgYXBwcm92YWxXYXlDaGFuZ2UgPSB1c2VFbWl0KEJPT0tfUEFHRV9BUFBST1ZBTF9QQVNTRU5HRVIpOwogIC8vIOebkeWQrOihjOeoi+WFs+iBlOeahOWHuuW3rueUs+ivt+aVsOaNrgogIHVzZUFkZExpc3RlbmVyKEJPT0tfUEFHRV9UUkFWRUxfVVBEQVRFLCAoZGF0YTogSVRyYXZlbFJlbGF0ZWREYXRhKSA9PiB7CiAgICBjb25zb2xlLmxvZygnc2V0VHJhdmVsUmVsYXRlZERhdGFfdXNlQWRkTGlzdGVuZXInLCBkYXRhKTsKICAgIHNldFRyYXZlbFJlbGF0ZWREYXRhKGRhdGEpOwogICAgLy8g5q+P5LiA5qyh6YCJ5oup6KGM56iL77yM6YO96ZyA6KaB6YeN572u5piv5ZCm57Sn5oCl6aKE5a6aCiAgICBpZiAoZGF0YS5lbWVyZ2VuY3kpIHsKICAgICAgc2V0U2VsZWN0ZWRFbWVyZ2VuY3kodHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBzZXRTZWxlY3RlZEVtZXJnZW5jeShmYWxzZSk7CiAgICB9CiAgICBpZiAoZGF0YT8udHJhdmVsTm8pIHsKICAgICAgc2V0U2VhcmNoQXBwcm92YWxOb0xpc3QoW2RhdGE/LnRyYXZlbE5vXSk7CiAgICB9IGVsc2UgewogICAgICBzZXRTZWFyY2hBcHByb3ZhbE5vTGlzdChbXSk7CiAgICB9CiAgICAvLyDpnIDopoHmtYvor5UgbWFpbk5vIOS4uuepuueahOaDheWGteS8muS4jeS8muW9seWTjeWIsOWFtuS7lua1geeoiwogICAgc2V0U2VsZWN0ZWRJdGVtKHtubzogJycsIG5hbWU6IHBsZWFzZVNlbGVjdFRleHQsIG1haW5ObzogJycsIHRyYXZlbExpc3Q6IFtdfSk7CiAgfSk7CiAgLy8g55uR5ZCs5pSv5LuY5pa55byP5pu05pS5CiAgdXNlQWRkTGlzdGVuZXIoUEFZTUVOVF9XQVlfRVZFTlQsIChkYXRhOiBQYXlUeXBlUmVsYXRpb25MaXN0VjIpID0+IHsKICAgIGNvbnNvbGUubG9nKCdwYXltZW50V2F5X3VzZUFkZExpc3RlbmVyJywgZGF0YSk7CiAgICBzZXRQYXlUeXBlKGRhdGE/LnBheW1lbnRXYXkpOwogIH0pOwogIC8vIOebkeWQrOWbvemZheaague8k+abtOaUuQogIHVzZUFkZExpc3RlbmVyKEJPT0tfUEFHRV9QT1NUUE9ORV9VUERBVEUsIChkYXRhOiB7cG9zdHBvbmU6IGJvb2xlYW59KSA9PiB7CiAgICBjb25zb2xlLmxvZygncG9zdHBvbmVfdXNlQWRkTGlzdGVuZXInLCBkYXRhKTsKICAgIHNldFBvc3Rwb25lKGRhdGE/LnBvc3Rwb25lKTsKICB9KTsKCiAgLy8g5a6h5om55Yid5aeL5YyWc2VsZWN0ZWRJdGVtCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIC8vIOaPkOWJjeWuoeaJuQogICAgaWYgKCF0cmlwQXBwbHkgJiYgYWR2YW5jZUFwcHJvdmUpIHsKICAgICAgc2V0U2VsZWN0ZWRFbWVyZ2VuY3koISFpc0VtZXJnZW5jeSk7CiAgICAgIHNldFNlbGVjdGVkSXRlbSh7CiAgICAgICAgbm86IGRlZmF1bHRBcHByb3ZhbE5vIHx8IGFwcHJvdmFsTm8gfHwgJycsCiAgICAgICAgbmFtZTogZGVmYXVsdEFwcHJvdmFsTWFpbk5vIHx8IGFwcHJvdmFsTWFpbk5vIHx8IGFwcHJvdmFsTm8gfHwgJycsCiAgICAgICAgbWFpbk5vOiBkZWZhdWx0QXBwcm92YWxNYWluTm8gfHwgYXBwcm92YWxNYWluTm8gfHwgJycsCiAgICAgIH0pOwogICAgICBpZiAoKGRlZmF1bHRBcHByb3ZhbE5vIHx8ICcnKSAhPT0gKGFwcHJvdmFsTm8gfHwgJycpKSB7CiAgICAgICAgRGV2VHJhY2UoRkxJR0hUX0JPT0tfREVWX0xPR19UUkFDRV9LRVlTLm9fY29ycF9mbHRfb3JkZXJfZGVmYXVsdF9hcHByb3ZhbG5vX25vdF9tYXRjaCwgewogICAgICAgICAgZGVmYXVsdEFwcHJvdmFsTm8sCiAgICAgICAgICBhcHByb3ZhbE5vLAogICAgICAgICAgZnVuY3Rpb25OYW1lOiAnaW5pdCcsCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgYXBwcm92YWxFbWl0KHthcHByb3ZhbE5vOiBkZWZhdWx0QXBwcm92YWxObyB8fCBhcHByb3ZhbE5vLCBpc0VtZXJnZW5jeTogISFpc0VtZXJnZW5jeX0pOwogICAgICAvLyDliY3nva7kuI3lj6/nvJbovpEKICAgICAgc2V0Q2FuTW9kaWZ5KCFwcmVBZHZhbmNlQXBwcm92ZSk7CiAgICAgIGlmICghcHJlQWR2YW5jZUFwcHJvdmUpIHsKICAgICAgICByZWNhbGN1bGF0ZUNvbnRyb2woe2lzRW1lcmdlbmN5OiAhIWlzRW1lcmdlbmN5LCBhcHByb3ZhbE5vOiBkZWZhdWx0QXBwcm92YWxOb30pOwogICAgICB9CiAgICAgIC8vIOWHuuW3rueUs+ivtwogICAgfSBlbHNlIGlmICh0cmlwQXBwbHkgJiYgIWFkdmFuY2VBcHByb3ZlKSB7CiAgICAgIHNldFNlbGVjdGVkRW1lcmdlbmN5KGZhbHNlKTsKICAgICAgc2V0U2VsZWN0ZWRJdGVtKGluaXRTZWxlY3RlZEl0ZW0pOwogICAgICBzZXRDYW5Nb2RpZnkodHJ1ZSk7CiAgICB9CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCiAgfSwgWwogICAgcHJlQWR2YW5jZUFwcHJvdmUsCiAgICBpc0VtZXJnZW5jeSwKICAgIGFkdmFuY2VBcHByb3ZlLAogICAgdHJpcEFwcGx5LAogICAgZGVmYXVsdEFwcHJvdmFsTWFpbk5vLAogICAgZGVmYXVsdEFwcHJvdmFsTm8sCiAgXSk7CgogIGNvbnN0IHJlY2FsY3VsYXRlQ29udHJvbCA9IGFzeW5jICh7aXNFbWVyZ2VuY3ksIGFwcHJvdmFsTm99OiB7aXNFbWVyZ2VuY3k6IGJvb2xlYW47IGFwcHJvdmFsTm86IHN0cmluZ30pID0+IHsKICAgIGlmICghaXNJbnRsKSB7CiAgICAgIGF3YWl0IGZldGNoUmVjYWxjdWxhdGVDb250cm9sKGlzRW1lcmdlbmN5LCBhcHByb3ZhbE5vKTsKICAgIH0KICB9OwoKICBjb25zdCBmZXRjaEFwcHJvdmFsTGlzdCA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHF1ZXJpZXMgPSBnZXRBbGxRdWVyeSgpOwogICAgY29uc3Qge21zc29rZXl9ID0gcXVlcmllczsKICAgIGNvbnN0IGNvb2tpZVNTTyA9IGdldENvb2tpZSgnbXNzb2tleScpOwogICAgY29uc3QgcGFyYW1zID0gewogICAgICBpc1ByZXBvc2l0aW9uOiAxLAogICAgICBvYVR5cGU6IGlzSW50bCA/IEVPYVR5cGUuaW50ZXJuYXRpb25hbCA6IEVPYVR5cGUuZG9tZXN0aWMsCiAgICAgIHNzb0tleTogbXNzb2tleSB8fCBjb29raWVTU08gfHwgJycsCiAgICB9OwoKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHNlYXJjaEFwcHJvdmFsTGlzdChwYXJhbXMsIHsKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgICAgcHJvZHVjdE5hbWU6IFBST0RVQ1RfTkFNRSwKICAgICAgfSk7CiAgICAgIGlmIChyZXMgJiYgcmVzLlJlc3BvbnNlICYmIHJlcy5SZXNwb25zZS5BcHByb3ZhbCkgewogICAgICAgIGNvbnN0IEFwcHJvdmFsID0gcmVzLlJlc3BvbnNlLkFwcHJvdmFsOwogICAgICAgIGNvbnN0IHttYWluTm8sIG5vLCBncmF5RmxhZ30gPSBBcHByb3ZhbD8uZGVmYXVsdEFwcHJvdmFsSW5mbyA/PyB7fTsKICAgICAgICBpZiAoZ3JheUZsYWcpIHsKICAgICAgICAgIGlmIChubykgewogICAgICAgICAgICBEZXZUcmFjZShGTElHSFRfQk9PS19ERVZfTE9HX1RSQUNFX0tFWVMub19jb3JwX2ZsdF9vcmRlcl9kZWZhdWx0X2FwcHJvdmFsbm9fbm90X21hdGNoLCB7CiAgICAgICAgICAgICAgYXBwcm92YWxObzogbm8sCiAgICAgICAgICAgICAgZGVmYXVsdEFwcHJvdmFsTWFpbk5vOiAnJywKICAgICAgICAgICAgICBmdW5jdGlvbk5hbWU6ICdmZXRjaEFwcHJvdmFsTGlzdCcsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgc2V0U2VsZWN0ZWRJdGVtKHtubzogbm8gfHwgJycsIG5hbWU6IG1haW5ObyB8fCAnJywgbWFpbk5vOiBtYWluTm8gfHwgJyd9KTsKICAgICAgICAgIGFwcHJvdmFsRW1pdCh7YXBwcm92YWxObzogbm8sIGlzRW1lcmdlbmN5OiAhIWlzRW1lcmdlbmN5fSk7CiAgICAgICAgICBpZiAoIWlzSW50bCkgewogICAgICAgICAgICBhd2FpdCBmZXRjaFJlY2FsY3VsYXRlQ29udHJvbChpc0VtZXJnZW5jeSwgbm8pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBEZXZUcmFjZShGTElHSFRfQk9PS19ERVZfTE9HX1RSQUNFX0tFWVMuRkxJR0hUX0JPT0tfQVBJX0ZBSUxFRCwgewogICAgICAgICAgcHJvZHVjdExpbmU6IFBST0RVQ1RfTkFNRSwKICAgICAgICAgIHBhZ2VOYW1lOiBCT09LX1BBR0VfTkFNRSwKICAgICAgICAgIHNlcnZpY2VOYW1lOiAnQ29ycEZyb250ZW5kQmFzaWNDb21tb24nLAogICAgICAgICAgb3BlcmF0aW9uOiAnZmV0Y2hBcHByb3ZhbExpc3QnLAogICAgICAgICAgR0U6IHJlcz8uR0UsCiAgICAgICAgICBtZXNzYWdlOiByZXM/LkVycm9yTWVzc2FnZSwKICAgICAgICB9KTsKICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgVHJhY2VUcnlDYXRjaChlcnJvciwgewogICAgICAgIGJsb2NrOiB0cnVlLAogICAgICAgIGZ1bmN0aW9uTmFtZTogJ2ZldGNoQXBwcm92YWxMaXN0JywKICAgICAgICBwcm9kdWN0TGluZTogUFJPRFVDVF9MSU5FLAogICAgICAgIHBhZ2VOYW1lOiBCT09LX1BBR0VfTkFNRSwKICAgICAgfSk7CiAgICB9CiAgfSwgW2lzSW50bCwgdW5pcXVlS2V5XSk7CgogIC8vIOaPkOWJjeWuoeaJueWQjue9rgogIC8vIOetieWIsOaciXVuaXF1ZWtleeWGjeWPkeivt+axgu+8jOS4jeeEtuWbnuiwg+mHjOaLv+S4jeWIsHVuaXF1ZWtleQogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAvLyDlnKhtaWNl5o2i5Y2h6ZyA5rGC5Lit77yMSDUvT25saW5l57uf5LiA5Y+WZGVmYXVsdEFwcHJvdmFsTm/lkoxkZWZhdWx0QXBwcm92YWxNYWluTm8KICAgIGlmIChhZHZhbmNlQXBwcm92ZSAmJiAhcHJlQWR2YW5jZUFwcHJvdmUgJiYgdW5pcXVlS2V5ICYmICFkZWZhdWx0QXBwcm92YWxObykgewogICAgICBmZXRjaEFwcHJvdmFsTGlzdCgpOwogICAgfQogIH0sIFthZHZhbmNlQXBwcm92ZSwgcHJlQWR2YW5jZUFwcHJvdmUsIGZldGNoQXBwcm92YWxMaXN0LCBkZWZhdWx0QXBwcm92YWxObywgdW5pcXVlS2V5XSk7CgogIC8vIOWIneWni+WMluebkeWQrOm7mOiupOWuoeaJueWNleWPt++8jOWmguaenOaciem7mOiupOWuoeaJueWNleWPt++8jOiwg3JlY2FsY3VsYXRlQ29udHJvbAogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBjb25zdCBhc3luY1JlY2FsY3VsYXRlQ29udHJvbCA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKGFkdmFuY2VBcHByb3ZlICYmICFwcmVBZHZhbmNlQXBwcm92ZSAmJiBkZWZhdWx0QXBwcm92YWxObykgewogICAgICAgIGF3YWl0IHJlY2FsY3VsYXRlQ29udHJvbCh7aXNFbWVyZ2VuY3k6ICEhaXNFbWVyZ2VuY3ksIGFwcHJvdmFsTm86IGRlZmF1bHRBcHByb3ZhbE5vfSk7CiAgICAgIH0KICAgIH07CgogICAgYXN5bmNSZWNhbGN1bGF0ZUNvbnRyb2woKTsKICB9LCBbYWR2YW5jZUFwcHJvdmUsIHByZUFkdmFuY2VBcHByb3ZlLCBkZWZhdWx0QXBwcm92YWxOb10pOwoKICAvLyDliJ3lp4vljJblh7rlt67nlLPor7dzZWxlY3RlZEl0ZW3lj4rlpJbmmL7kv6Hmga8KICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHRyaXBBcHBseSkgewogICAgICBjb25zdCBpbml0RGF0YSA9IGFzeW5jICgpID0+IHsKICAgICAgICBpZiAodGFPcmRlck5vKSB7CiAgICAgICAgICBpZiAodGFUcmF2ZWxQbGFuTm8pIHsKICAgICAgICAgICAgc2V0U2VsZWN0ZWRJdGVtKHtubzogdGFUcmF2ZWxQbGFuTm8sIG5hbWU6IHRhT3JkZXJObywgbWFpbk5vOiB0YU9yZGVyTm8sIHRyYXZlbExpc3Q6IFtdfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRTZWFyY2hBcHByb3ZhbE5vTGlzdChbdGFPcmRlck5vXSk7CiAgICAgICAgICAgIC8vIHNldFNlbGVjdGVkSXRlbSh7IG5vOiAnJywgbmFtZTogJycsIG1haW5ObzogdGFPcmRlck5vLCB0cmF2ZWxMaXN0OiBbXSB9KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhd2FpdCBnZXRUcmF2ZWxBcHBsaWNhdGlvbk91dERldGFpbCgpOwogICAgICB9OwogICAgICBpbml0RGF0YSgpOwogICAgfQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwogIH0sIFt0cmlwQXBwbHksIHRyYXZlbFJlbGF0ZWREYXRhPy50cmlwSWQsIHRyYXZlbFJlbGF0ZWREYXRhPy50cmF2ZWxObywgdGFPcmRlck5vLCB0YVRyYXZlbFBsYW5Ob10pOwoKICAvLyDlrqHmibnliJ3lp4vljJYg5a6h5om55ZCO572uICsgbWljZQogIC8vIOWPkeW4g+WFvOWuue+8jOWQjue7reWIoOmZpAogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAoYWR2YW5jZUFwcHJvdmUgJiYgaXNNaWNlICYmICFkZWZhdWx0QXBwcm92YWxObykgewogICAgICBjb25zdCBpbml0QXBwcm92YWwgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgZmV0Y2hHZXRFYXJpZXJBcHByb3ZlKCk7CiAgICAgIH07CiAgICAgIGluaXRBcHByb3ZhbCgpOwogICAgfQogIH0sIFtpc01pY2UsIGFkdmFuY2VBcHByb3ZlLCBkZWZhdWx0QXBwcm92YWxOb10pOwoKICAvLyDpgInmi6nlrqHmibnlkI7nva7miJbogIXmlrDniYjlh7rlt67nlLPor7cKICBjb25zdCBzZWxlY3RJdGVtRm4gPSBhc3luYyAoaXNFbWVyZ2VuY3k6IGJvb2xlYW4sIGRhdGEpID0+IHsKICAgIGNvbnNvbGUubG9nKCdzZWxlY3RJdGVtRm5faXNFbWVyZ2VuY3knLCBpc0VtZXJnZW5jeSk7CiAgICBjb25zb2xlLmxvZygnc2VsZWN0SXRlbUZuX2RhdGEnLCBkYXRhKTsKICAgIGlmICghdHJpcEFwcGx5ICYmIHN3aXRjaEFwcHJvdmFsUGFzc2VuZ2VyQ2xlYXIpIHsKICAgICAgLy8g5Y+R5LqL5Lu257uZ5LmY5py65Lq677yM6YeN5Yi35LmY5py65Lq65YiX6KGoCiAgICAgIGFwcHJvdmFsV2F5Q2hhbmdlKCEhaXNFbWVyZ2VuY3kpOwogICAgfQogICAgc2V0Tm9TZWxlY3RlZFRpcCgnJyk7CiAgICBzZXRTZWxlY3RlZEVtZXJnZW5jeShpc0VtZXJnZW5jeSk7CiAgICBpZiAoZGF0YSAmJiAhaXNFbWVyZ2VuY3kpIHsKICAgICAgc2V0U2VsZWN0ZWRJdGVtKHsKICAgICAgICBubzogZGF0YT8uTm8gfHwgJycsIC8v5Ye65beu55Sz6K+355qE5Ye66KGM6K6h5YiS5Y2V5Y+35oiW6ICF5a6h5om55Y2V5Y+3CiAgICAgICAgbmFtZTogZGF0YT8ubWFpbk5vIHx8IGRhdGE/Lk5vIHx8ICcnLCAvL+WHuuW3rueUs+ivt+WNleWPt+aIluiAheWuoeaJueWNleWPtwogICAgICAgIG1haW5ObzogZGF0YT8ubWFpbk5vIHx8ICcnLAogICAgICAgIHRyYXZlbExpc3Q6IFtdLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghaXNFbWVyZ2VuY3kpIHsKICAgICAgICBpZiAodHJpcEFwcGx5KSB7CiAgICAgICAgICBpbnZhbGlkQW5jaG9yKGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW52YWxpZEFuY2hvcih0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2V0U2VsZWN0ZWRJdGVtKGluaXRTZWxlY3RlZEl0ZW0pOwogICAgfQogICAgRGV2VHJhY2UoRkxJR0hUX0JPT0tfREVWX0xPR19UUkFDRV9LRVlTLm9fY29ycF9mbHRfYm9va19wb3N0QXBwcm92YWxfY2FsbGRhdGEsIHtpc0VtZXJnZW5jeSwgZGF0YX0pOwogICAgLy8g5a6h5om55ZCO572u5qC55o2u5a6h5om55Y2V5Y+35Yik5pat5piv5ZCm5pSv5oyB5re35LuYCiAgICBpZiAoYWR2YW5jZUFwcHJvdmUpIHsKICAgICAgYXBwcm92YWxFbWl0KHthcHByb3ZhbE5vOiBkYXRhPy5ObyB8fCAnJywgaXNFbWVyZ2VuY3l9KTsKICAgICAgLy8g5Zu96ZmF5py656Wo5rKh5pyJ5a6h5om55Y2V566h5o6n55qE6ZyA5rGC77yM5LiN6KaB6LCDcmVjYWxjdWxhdGVDb250cm9s77yM5Lmf5LiN6KaB5pu05paw5pSv5LuY6YWN6YCB5ZKM5L+d6ZmpCiAgICAgIGF3YWl0IHJlY2FsY3VsYXRlQ29udHJvbCh7aXNFbWVyZ2VuY3ksIGFwcHJvdmFsTm86IGRhdGE/Lk5vfSk7CiAgICB9CiAgICBpZiAodHJpcEFwcGx5ICYmICFpc0VtZXJnZW5jeSkgewogICAgICBpZiAob3BlblJvdXRlKSB7CiAgICAgICAgaWYgKCFkYXRhPy5tYWluTm8pIHsKICAgICAgICAgIC8vIOWPjemAieWPlua2iOeKtuaAgQogICAgICAgICAgcmV0dXJuIGNhbmNlbFRyYXZlbEFwcGxpY2F0aW9uKCk7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5UcmlwTW9kZShkYXRhPy5tYWluTm8sIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGF3YWl0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5TaW5nbGUoZGF0YT8ubWFpbk5vLCBkYXRhPy5Obyk7CiAgICAgIH0KICAgIH0KICB9OwoKICBjb25zdCBjYW5jZWxUcmF2ZWxBcHBsaWNhdGlvbiA9ICgpID0+IHsKICAgIHNldFJlbGF0ZWRUcmF2ZWxBcHBsaWNhdGlvbihpbml0U2VsZWN0ZWRJdGVtKTsKICB9OwoKICAvLyDpgInmi6nml6fniYjlh7rlt67nlLPor7cKICBjb25zdCBzZWxlY3RJdGVtRm5PbGQgPSBhc3luYyAoaXNFbWVyZ2VuY3k6IGJvb2xlYW4sIGRhdGEpID0+IHsKICAgIHNldE5vU2VsZWN0ZWRUaXAoJycpOwogICAgc2V0U2VsZWN0ZWRFbWVyZ2VuY3koaXNFbWVyZ2VuY3kpOwogICAgaWYgKGRhdGEgJiYgIWlzRW1lcmdlbmN5KSB7CiAgICAgIHNldFNlbGVjdGVkSXRlbSh7CiAgICAgICAgbm86IGRhdGE/LnBsYW4/LnRyaXBQbGFuSWQgfHwgJycsIC8vIOWHuuihjOiuoeWIkuWNleWPtwogICAgICAgIG5hbWU6IGRhdGE/Lm9yZGVyTnVtYmVyIHx8ICcnLAogICAgICAgIG1haW5ObzogZGF0YT8ub3JkZXJOdW1iZXIgfHwgJycsIC8vIOWHuuW3rueUs+ivt+WNleWPtwogICAgICAgIHRyYXZlbExpc3Q6IFtdLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghaXNFbWVyZ2VuY3kpIHsKICAgICAgICBpbnZhbGlkQW5jaG9yKGZhbHNlKTsKICAgICAgfQogICAgICBzZXRTZWxlY3RlZEl0ZW0oaW5pdFNlbGVjdGVkSXRlbSk7CiAgICB9CiAgICBEZXZUcmFjZShGTElHSFRfQk9PS19ERVZfTE9HX1RSQUNFX0tFWVMub19jb3JwX2ZsdF9ib29rX29sZFRyYXZlbEFwcF9jYWxsZGF0YSwge2lzRW1lcmdlbmN5LCBkYXRhfSk7CiAgICBpZiAoIWlzRW1lcmdlbmN5KSB7CiAgICAgIGlmIChvcGVuUm91dGUpIHsKICAgICAgICBhd2FpdCB0cmF2ZWxBcHBsaWNhdGlvbkRldGFpbEluVHJpcE1vZGUoZGF0YT8ub3JkZXJOdW1iZXIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGF3YWl0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5TaW5nbGUoZGF0YT8ub3JkZXJOdW1iZXIsIGRhdGE/LnBsYW4/LnRyaXBQbGFuSWQpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gbWljZSDkuI3lsZXnpLrlrqHmibnljZXlhaXlj6PvvIzkvYbmmK/pnIDopoHosIPmjqXlj6MgZ2V0RWFyaWVyQXBwcm92Ze+8jAogIGNvbnN0IGZldGNoR2V0RWFyaWVyQXBwcm92ZSA9IGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHBhcmFtc05ldyA9IHsKICAgICAgcGlkOiBwSWQsCiAgICAgIHVuaXF1ZUtleTogdW5pcXVlS2V5LAogICAgICBpZExpc3Q6IFtdLAogICAgICBpbnRsOiBpc0ludGwsCiAgICB9OwogICAgdHJ5IHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0RWFyaWVyQXBwcm92ZShwYXJhbXNOZXcsIHsKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgICAgcHJvZHVjdE5hbWU6IFBST0RVQ1RfTkFNRSwKICAgICAgfSk7CiAgICAgIGlmIChyZXM/LlJlc3BvbnNlKSB7CiAgICAgICAgY29uc3QgbWljZUFwcHJvdmFsTm8gPSByZXMuUmVzcG9uc2U/LmFwcHJvdmVMaXN0Py5bMF0/LmlkIHx8ICcnOwogICAgICAgIHNldFNlbGVjdGVkSXRlbSh7bm86IG1pY2VBcHByb3ZhbE5vLCBuYW1lOiBtaWNlQXBwcm92YWxOb30pOwogICAgICAgIGFwcHJvdmFsRW1pdCh7YXBwcm92YWxObzogbWljZUFwcHJvdmFsTm8sIGlzRW1lcmdlbmN5fSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gdG9kbyDlvILluLjlpITnkIYKICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgaWYgKGlzQ2FuY2VsKGVycm9yKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBUcmFjZVRyeUNhdGNoKGVycm9yLCB7CiAgICAgICAgYmxvY2s6IHRydWUsCiAgICAgICAgZnVuY3Rpb25OYW1lOiAnZmV0Y2hSZWNhbGN1bGF0ZUNvbnRyb2wnLAogICAgICAgIHByb2R1Y3RMaW5lOiBQUk9EVUNUX0xJTkUsCiAgICAgICAgcGFnZU5hbWU6IEJPT0tfUEFHRV9OQU1FLAogICAgICB9KTsKICAgIH0KICB9OwoKICAvLyDlm73lhoXlrqHmibnlkI7nva7mt7fku5gt6YCJ5oup5a6h5om55Y2V5ZCO6LCDIHJlY2FsY3VsYXRlQ29udHJvbCDmjqXlj6MKICBjb25zdCBmZXRjaFJlY2FsY3VsYXRlQ29udHJvbCA9IGFzeW5jIChpc0VtZXJnZW5jeTogYm9vbGVhbiwgYXBwcm92YWxObzogc3RyaW5nKSA9PiB7CiAgICBjb25zdCBwYXJhbXNOZXc6IFJlY2FsY3VsYXRlQ29udHJvbFJlcXVlc3RUeXBlID0gewogICAgICBwaWQ6IHBJZCwKICAgICAgdW5pcXVlS2V5OiB1bmlxdWVLZXksCiAgICAgIGFwcHJvdmFsTm86IGFwcHJvdmFsTm8gfHwgJycsCiAgICAgIGVtZXJnZW5jeTogaXNFbWVyZ2VuY3kgfHwgZmFsc2UsCiAgICAgIGFwcHJvdmFsU3VwcG9ydE1peFBheTogbWl4UGF5SW5mbz8uYXBwcm92YWxTdXBwb3J0TWl4UGF5IHx8IGZhbHNlLAogICAgfTsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlY2FsY3VsYXRlQ29udHJvbFJlcXVlc3QocGFyYW1zTmV3LCB7CiAgICAgICAgcGFnZU5hbWU6IEJPT0tfUEFHRV9OQU1FLAogICAgICAgIHByb2R1Y3ROYW1lOiBQUk9EVUNUX05BTUUsCiAgICAgIH0pOwogICAgICBpZiAocmVzPy5SZXN1bHQgJiYgcmVzPy5SZXNwb25zZSkgewogICAgICAgIGNvbnN0IG1peFBheUluZm9EYXRhID0gcmVzLlJlc3BvbnNlPy5taXhQYXlJbmZvOwogICAgICAgIHNldE1peFBheUluZm8obWl4UGF5SW5mb0RhdGEpOwogICAgICAgIG1peFBheUtleUVtaXQobWl4UGF5SW5mb0RhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRvZG8g5byC5bi45aSE55CGCiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIFRyYWNlVHJ5Q2F0Y2goZXJyb3IsIHsKICAgICAgICBibG9jazogdHJ1ZSwKICAgICAgICBmdW5jdGlvbk5hbWU6ICdmZXRjaFJlY2FsY3VsYXRlQ29udHJvbCcsCiAgICAgICAgcHJvZHVjdExpbmU6IFBST0RVQ1RfTElORSwKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIOagvOW8j+WMluavj+S4quihjOeoi+WIl+ihqOivpuaDheeahOWxleekuuaWh+ahiAogICAqLwogIGNvbnN0IGZvcm1hdFRyYXZlbERldGFpbERpc3BsYXkgPSAodHJhdmVsSXRlbSwgZW5kb3JzZW1lbnRUeXBlKTogc3RyaW5nW10gPT4gewogICAgbGV0IGNvbnRlbnQ6IHN0cmluZ1tdID0gW107CiAgICBsZXQgcm93T25lOiBzdHJpbmc7CiAgICBsZXQgcm93VHdvOiBzdHJpbmc7CiAgICBsZXQgcm93VGhyZWU6IHN0cmluZzsKICAgIGNvbnN0IHRyYXZlbEVuZFRpbWVUZXh0ID0KICAgICAgdHJhdmVsSXRlbS5qb3VybmFsVHlwZSA9PT0gMgogICAgICAgID8gYCwgJHt0cmF2ZWxJdGVtLmVuZFRpbWUgfHwgJyd9JHtnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLnRyYXZlbEFwcGxpY2F0aW9uUmV0dXJuVHJpcCl9YAogICAgICAgIDogJyc7CiAgICBjb25zdCB0cmF2ZWxTdGFydFRpbWVUZXh0ID0KICAgICAgdHJhdmVsSXRlbS5qb3VybmFsVHlwZSA9PT0gMQogICAgICAgID8gYCR7dHJhdmVsSXRlbS5zdGFydFRpbWUgfHwgJyd9YAogICAgICAgIDogYCR7dHJhdmVsSXRlbS5zdGFydFRpbWUgfHwgJyd9JHtnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLnRyYXZlbEFwcGxpY2F0aW9uRGVwYXJ0dXJlKX1gOwogICAgc3dpdGNoIChlbmRvcnNlbWVudFR5cGUpIHsKICAgICAgLy8g6YeR6aKdCiAgICAgIGNhc2UgMToKICAgICAgICByb3dPbmUgPSBgJHt0cmF2ZWxTdGFydFRpbWVUZXh0fSR7dHJhdmVsRW5kVGltZVRleHR9YDsKICAgICAgICByb3dUd28gPSBgJHt0cmF2ZWxJdGVtLmFpcmxpbmUgfHwgJyd9JHt0cmF2ZWxJdGVtLmFpcmxpbmUgPyAnICcgOiAnJ30ke3RyYXZlbEl0ZW0uZGlzY291bnRNc2cgfHwgJyd9YDsKICAgICAgICByb3dUaHJlZSA9IGAke3RyYXZlbEl0ZW0uY29zdEltcGxhY2F0aW9uIHx8ICcnfWA7CiAgICAgICAgY29udGVudCA9IFtyb3dPbmUsIHJvd1R3bywgcm93VGhyZWVdOwogICAgICAgIGJyZWFrOwogICAgICAvLyDkuovnlLEKICAgICAgY2FzZSAyOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IGRlcGFydHVyZSA9IEFycmF5LmlzQXJyYXkodHJhdmVsSXRlbS5kZXBhcnR1cmUpCiAgICAgICAgICAgID8gdHJhdmVsSXRlbS5kZXBhcnR1cmUuam9pbign44CBJykKICAgICAgICAgICAgOiB0cmF2ZWxJdGVtLmRlcGFydHVyZTsKICAgICAgICAgIGNvbnN0IGFycml2YWwgPSBBcnJheS5pc0FycmF5KHRyYXZlbEl0ZW0uYXJyaXZhbCkgPyB0cmF2ZWxJdGVtLmFycml2YWwuam9pbign44CBJykgOiB0cmF2ZWxJdGVtLmFycml2YWw7CgogICAgICAgICAgY29uc3QgZGVwYXJ0dXJlVGV4dCA9IGRlcGFydHVyZQogICAgICAgICAgICA/IGAke2RlcGFydHVyZX0ke2dldFNoYXJrVmFsdWUoRkxJR0hUX0JPT0tfU0hBUksudHJhdmVsQXBwbGljYXRpb25EZXBhcnR1cmUpfWAKICAgICAgICAgICAgOiAnJzsKICAgICAgICAgIGNvbnN0IGFycml2YWxUZXh0ID0gYXJyaXZhbCA/IGAke2Fycml2YWx9JHtnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLnRyYXZlbEFwcGxpY2F0aW9uQXJyaXZhbCl9YCA6ICcnOwogICAgICAgICAgY29uc3Qgam9pbk1hcmsgPSBkZXBhcnR1cmVUZXh0ICYmIGFycml2YWxUZXh0ID8gJyAtICcgOiAnJzsKICAgICAgICAgIHJvd09uZSA9IGAke2RlcGFydHVyZVRleHR9JHtqb2luTWFya30ke2Fycml2YWxUZXh0fWA7CiAgICAgICAgICByb3dUd28gPSBgJHt0cmF2ZWxJdGVtLnJlbWFyayB8fCAnJ31gOwogICAgICAgICAgY29udGVudCA9IFtyb3dPbmUsIHJvd1R3b107CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIGNvbnRlbnQuZmlsdGVyKEJvb2xlYW4pOwogIH07CgogIC8qKgogICAqIOS7juWHuuW3rueUs+ivt+WIl+ihqOS4reaJvuWIsOWFs+iBlOeUs+ivt+WNlQogICAqLwogIGNvbnN0IGZpbmRSZWxhdGVkQXBwbGljYXRpb24gPSAoCiAgICBhcHBsaWNhdGlvbkxpc3Q6IElBcHBsaWNhdGlvbkl0ZW1bXSwKICAgIHRyYXZlbE5vOiBzdHJpbmcgfCBudW1iZXIsCiAgICB0cmF2ZWxQbGFuTm86IHN0cmluZyB8IG51bWJlciwKICAgIGVuZG9yc2VtZW50VHlwZTogbnVtYmVyLAogICkgPT4gewogICAgY29uc3QgdGFyZ2V0QXBwbGljYXRpb24gPSBhcHBsaWNhdGlvbkxpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdHJhdmVsTm8pOwogICAgaWYgKHRhcmdldEFwcGxpY2F0aW9uKSB7CiAgICAgIGNvbnN0IHRhcmdldFRyYXZlbCA9IHRhcmdldEFwcGxpY2F0aW9uPy50cmlwTGlzdD8uZmluZCgoZWxlKSA9PiBlbGUuaWQgPT09IHRyYXZlbFBsYW5Obyk7CiAgICAgIGlmICh0YXJnZXRUcmF2ZWwpIHsKICAgICAgICBpZiAoIXRhcmdldFRyYXZlbD8uc3RhcnRUaW1lIHx8ICF0YXJnZXRUcmF2ZWw/LmVuZFRpbWUpIHsKICAgICAgICAgIGNvbnN0IHRyYXZlbFN0YXJ0VGltZSA9IHltZEZ1bGxTdHJpbmcodGFyZ2V0VHJhdmVsPy50cmF2ZWxTdGFydFRpbWUpOwogICAgICAgICAgY29uc3QgdHJhdmVsRW5kVGltZSA9IHltZEZ1bGxTdHJpbmcodGFyZ2V0VHJhdmVsPy50cmF2ZWxFbmRUaW1lKTsKICAgICAgICAgIHRhcmdldFRyYXZlbC5zdGFydFRpbWUgPSB0cmF2ZWxTdGFydFRpbWU7CiAgICAgICAgICB0YXJnZXRUcmF2ZWwuZW5kVGltZSA9IHRyYXZlbEVuZFRpbWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRldGFpbHNEaXNwbGF5ID0gZm9ybWF0VHJhdmVsRGV0YWlsRGlzcGxheSh0YXJnZXRUcmF2ZWwsIGVuZG9yc2VtZW50VHlwZSk7CiAgICAgICAgdGFyZ2V0QXBwbGljYXRpb24udHJhdmVsTGlzdCA9IFt7Li4udGFyZ2V0VHJhdmVsLCBkZXRhaWxzRGlzcGxheX1dOwogICAgICAgIHJldHVybiB0YXJnZXRBcHBsaWNhdGlvbjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBcHBsaWNhdGlvbi50cmF2ZWxMaXN0ID0gW107CiAgICAgICAgcmV0dXJuIHRhcmdldEFwcGxpY2F0aW9uOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9OwoKICAvKioKICAgKiDooYznqIvmqKHlvI/kuIvvvJrlsZXnpLrpgInmi6nlh7rlt67nlLPor7fljZXlm57mmL7liLDloavlhpnpobXnmoTkv6Hmga/vvIzmraTml7blj6rmnInlh7rlt67nlLPor7fljZXlj7fvvIzml6Dlh7rooYzorqHliJLljZXlj7cKICAgKiBAcGFyYW0gdHJhdmVsTm8g5Ye65beu55Sz6K+35Y2V5Y+3CiAgICogQHBhcmFtIGNhbk1vZGlmeSDmmK/lkKblj6/mm7TmjaLlh7rlt67nlLPor7fljZUKICAgKiBAcGFyYW0gbWFpbk5vIGNoYW5nZeaXtui/lOWbnueahOS4u+WNleWPtwogICAqLwogIGNvbnN0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5UcmlwTW9kZSA9IGFzeW5jICh0cmF2ZWxObzogc3RyaW5nLCBjYW5Nb2RpZnk6IGJvb2xlYW4pID0+IHsKICAgIC8vIOihjOeoiyvlhbPogZTlh7rlt67nlLPor7fljZXlj7fvvIzloavlhpnpobXlsZXnpLrlh7rooYzml7bmrrUKICAgIGNvbnNvbGUubG9nKDIyMjIyLCB0cmF2ZWxObywgY2FuTW9kaWZ5KTsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcXVlc3RQYXJhbXM6IEdldFRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsUmVxdWVzdFR5cGUgPSB7CiAgICAgICAgb3JkZXJOdW1iZXI6IE51bWJlcih0cmF2ZWxObyksCiAgICAgIH07CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldFRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsKHJlcXVlc3RQYXJhbXMsIHsKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgICAgcHJvZHVjdE5hbWU6IFBST0RVQ1RfTkFNRSwKICAgICAgfSk7CiAgICAgIGlmIChyZXM/LlJlc3BvbnNlKSB7CiAgICAgICAgY29uc3Qge3RyYXZlbERhdGUsIHRyYXZlbFJlYXNvbiwgdHJpcExpc3R9ID0gcmVzLlJlc3BvbnNlPy5vcmRlckRldGFpbCB8fCB7fTsKICAgICAgICBjb25zdCBkZXBhcnR1cmUgPSB5bWRGdWxsU3RyaW5nKHRyYXZlbERhdGU/LmRlcGFydERhdGUgfHwgJycpOwogICAgICAgIGNvbnN0IGFycml2YWwgPSB5bWRGdWxsU3RyaW5nKHRyYXZlbERhdGU/LnJldHVybkRhdGUgfHwgJycpOwogICAgICAgIGNvbnN0IHJlbGF0ZWRBcHBsaWNhdGlvbjogSVBvc3RBcHByb3ZhbFRyYXZlbEFwcGxpY2F0aW9uSXRlbSA9IHsKICAgICAgICAgIG5vOiBTdHJpbmcodHJhdmVsTm8pLAogICAgICAgICAgbmFtZTogdHJhdmVsUmVhc29uIHx8ICcnLAogICAgICAgICAgLy8g5Ye66KGM5pe25q616YCC6YWN6KGM56iL5Y2h54mH5bGV56S677yI6YeR6aKd77yaZGVwYXJ0dXJl77yMYXJyaXZhbO+8jOS6i+eUse+8mnN0YXJ0VGltZe+8jGVuZFRpbWXvvIkKICAgICAgICAgIHRyYXZlbExpc3Q6IFt7ZGVwYXJ0dXJlLCBhcnJpdmFsLCBzdGFydFRpbWU6IGRlcGFydHVyZSwgZW5kVGltZTogYXJyaXZhbH1dLAogICAgICAgIH07CiAgICAgICAgc2V0UmVsYXRlZFRyYXZlbEFwcGxpY2F0aW9uKHJlbGF0ZWRBcHBsaWNhdGlvbik7CiAgICAgICAgc2V0Q2FuTW9kaWZ5KGNhbk1vZGlmeSk7CiAgICAgICAgc2V0U2VsZWN0ZWRFbWVyZ2VuY3koZmFsc2UpOwogICAgICAgIC8vIFRvRG8g6KGM56iL5qih5byP55So5Ye65beu55Sz6K+35Y2V5Y+36LCD5o6l5Y+j5ou/5Ye66KGM6K6h5YiS5Y2V5Y+377yM5L2G5piv5Ye66KGM6K6h5YiS5Y+v6IO95pyJ5aSa5Liq77yM5LiN6IO956Gu5a6a5Lyg5ZOq5Liq77yM562J57q/5LiK77yI6I2j5Yek56Wl77yJ56Gu6K6k5pa55qGI5YaN5ZCM5q2l5L+u5pS5CiAgICAgICAgaWYgKCFjYW5Nb2RpZnkpIHsKICAgICAgICAgIHNldFNlbGVjdGVkSXRlbSh7bm86IHRyaXBMaXN0Py5bMF0/LmlkLCBuYW1lOiB0cmF2ZWxObywgbWFpbk5vOiB0cmF2ZWxObywgdHJhdmVsTGlzdDogW119KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIFRyYWNlVHJ5Q2F0Y2goZXJyb3IsIHsKICAgICAgICBibG9jazogdHJ1ZSwKICAgICAgICBmdW5jdGlvbk5hbWU6ICd0cmF2ZWxBcHBsaWNhdGlvbkRldGFpbEluVHJpcE1vZGUnLAogICAgICAgIHByb2R1Y3RMaW5lOiBQUk9EVUNUX0xJTkUsCiAgICAgICAgcGFnZU5hbWU6IEJPT0tfUEFHRV9OQU1FLAogICAgICB9KTsKICAgIH0KICB9OwoKICAvKioKICAgKiDljZXorqLljZXmqKHlvI/kuIvvvJrlsZXnpLrpgInmi6nlh7rlt67nlLPor7fljZXlm57mmL7liLDloavlhpnpobXnmoTkv6Hmga8KICAgKiBAcGFyYW0gdHJhdmVsTm8g5Ye65beu55Sz6K+35Y2V5Y+3CiAgICogQHBhcmFtIHRhVHJhdmVsUGxhbk5vIOWHuuihjOiuoeWIkuWNleWPtwogICAqLwogIGNvbnN0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5TaW5nbGUgPSBhc3luYyAodHJhdmVsTm86IHN0cmluZywgdGFUcmF2ZWxQbGFuTm86IHN0cmluZykgPT4gewogICAgdHJ5IHsKICAgICAgbGV0IHJlcyA9IG51bGw7CiAgICAgIGNvbnN0IHJlcXVlc3RQYXJhbXM6IEdldFRyYXZlbEFwcGxpY2F0aW9uTGlzdFJlcXVlc3RUeXBlID0gewogICAgICAgIHRyYXZlbFR5cGU6IG9wZW5Sb3V0ZSA/ICcxJyA6ICcyJywgLy8gMTog6KGM56iLIDI6IOWNleiuouWNlQogICAgICAgIGlzSW50bCwKICAgICAgfTsKICAgICAgcmVzID0gYXdhaXQgZ2V0VHJhdmVsQXBwbGljYXRpb25MaXN0KHJlcXVlc3RQYXJhbXMsIHsKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgICAgcHJvZHVjdE5hbWU6IFBST0RVQ1RfTkFNRSwKICAgICAgfSk7CiAgICAgIGlmIChyZXMgJiYgcmVzLlJlc3VsdCAmJiByZXMuUmVzcG9uc2UpIHsKICAgICAgICBzZXRUcmF2ZWxMaXN0RGF0YShyZXMuUmVzcG9uc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRvZG8g5byC5bi45aSE55CGCiAgICAgICAgc2V0VHJhdmVsTGlzdERhdGEobnVsbCk7CiAgICAgIH0KICAgICAgaWYgKHRyYXZlbE5vKSB7CiAgICAgICAgY29uc3Qge2FwcGxpY2F0aW9uTGlzdCwgZW5kb3JzZW1lbnRUeXBlfSA9IHRyYXZlbExpc3REYXRhIHx8IHJlcz8uUmVzcG9uc2UgfHwge307CiAgICAgICAgLy8g6K6+572u5piv5ZCm5piv57Sn5oCl6aKE5a6aCiAgICAgICAgLy8gc2V0U2VsZWN0ZWRFbWVyZ2VuY3koaXNFbWVyZ2VuY3lSZXNlcnZlKQogICAgICAgIC8vIOiuvue9ruWHuuW3rueUs+ivt+exu+WeiwogICAgICAgIHNldEVuZG9yc2VtZW50VHlwZShlbmRvcnNlbWVudFR5cGUpOwogICAgICAgIGNvbnN0IHJlbGF0ZWRBcHBsaWNhdGlvbiA9IGZpbmRSZWxhdGVkQXBwbGljYXRpb24oYXBwbGljYXRpb25MaXN0LCB0cmF2ZWxObywgdGFUcmF2ZWxQbGFuTm8sIGVuZG9yc2VtZW50VHlwZSk7CiAgICAgICAgLy8g5aaC5p6cdHJhdmVsTGlzdOmVv+W6puS4ujHvvJrlhbPogZTkuoblh7rooYzorqHliJLjgIHkuI3lj6/nvJbovpEKICAgICAgICBpZiAocmVsYXRlZEFwcGxpY2F0aW9uKSB7CiAgICAgICAgICAvLyDlpoLmnpx0cmF2ZWxMaXN06ZW/5bqm5Li6Me+8jOihqOekuuWFs+iBlOS6huWHuuihjOiuoeWIku+8jOWmguaenOWkp+S6jjHvvIzmnKrlhbPogZTlh7rooYzorqHliJIKICAgICAgICAgIGNvbnN0IGlzUmVsYXRlZFRyYXZlbFBsYW4gPSByZWxhdGVkQXBwbGljYXRpb24/LnRyYXZlbExpc3Q/Lmxlbmd0aCA9PT0gMTsKICAgICAgICAgIC8vIOiuvue9ruWFs+iBlOeUs+ivt+WNlQogICAgICAgICAgaWYgKGlzUmVsYXRlZFRyYXZlbFBsYW4pIHsKICAgICAgICAgICAgc2V0UmVsYXRlZFRyYXZlbEFwcGxpY2F0aW9uKHJlbGF0ZWRBcHBsaWNhdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRTZWxlY3RlZEVtZXJnZW5jeShmYWxzZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBUcmFjZVRyeUNhdGNoKGVycm9yLCB7CiAgICAgICAgYmxvY2s6IHRydWUsCiAgICAgICAgZnVuY3Rpb25OYW1lOiAndHJhdmVsQXBwbGljYXRpb25EZXRhaWxJblNpbmdsZScsCiAgICAgICAgcHJvZHVjdExpbmU6IFBST0RVQ1RfTElORSwKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIOWIneWni+WMluWxleekuumAieaLqeWHuuW3rueUs+ivt+WNleWbnuaYvuWIsOWhq+WGmemhteeahOS/oeaBrwogICAqLwogIGNvbnN0IGdldFRyYXZlbEFwcGxpY2F0aW9uT3V0RGV0YWlsID0gYXN5bmMgKCkgPT4gewogICAgLy8g5aaC5p6c5pyJ5YWz6IGUdHJhdmVsTm/vvIzpnIDopoHlm57mmL7liLDloavlhpnpobUKICAgIGNvbnNvbGUubG9nKDMzMzMzLCBvcGVuUm91dGUsIHRyYXZlbFJlbGF0ZWREYXRhKTsKICAgIGlmIChvcGVuUm91dGUpIHsKICAgICAgY29uc3Qge3RyaXBJZCwgdHJhdmVsTm8sIGVtZXJnZW5jeX0gPSB0cmF2ZWxSZWxhdGVkRGF0YSB8fCB7fTsKICAgICAgLy8g6KGM56iL6buY6K6k5piv57Sn5oCl6aKE5a6aID0+IOS4jeWPr+aUue+8jOS4jeeUqOivt+axguWHuuW3rueUs+ivt+WIl+ihqAogICAgICBpZiAoZW1lcmdlbmN5KSB7CiAgICAgICAgc2V0Q2FuTW9kaWZ5KGZhbHNlKTsKICAgICAgICBzZXRTZWxlY3RlZEVtZXJnZW5jeSh0cnVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g5peg6KGM56iL5Y2V5Y+3ID0+IOaWsOihjOeoiyA9PiDotbDljZXorqLljZXluLjop4TlhaXlj6PpgLvovpEKICAgICAgaWYgKCF0cmlwSWQgfHwgdHJhdmVsTm8pIHsKICAgICAgICBzZXRSZWxhdGVkVHJhdmVsQXBwbGljYXRpb24oaW5pdFNlbGVjdGVkSXRlbSk7CiAgICAgICAgc2V0Q2FuTW9kaWZ5KHRydWUpOwogICAgICAgIGNvbnNvbGUubG9nKDMzMzM0LCBpbml0U2VsZWN0ZWRJdGVtKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g5pyJ6KGM56iL5Y2V5Y+3ICsg5peg5YWz6IGU5Ye65beu55Sz6K+35Y2V5Y+3ID0+IOihjOeoi+WFs+iBlOWNleWFs+iBlOe0p+aApemihOWumu+8jOWImeS4jeeUqOivt+axguWHuuW3rueUs+ivt+WIl+ihqAogICAgICBpZiAodHJpcElkICYmICF0cmF2ZWxObykgewogICAgICAgIHNldENhbk1vZGlmeSh0cnVlKTsKICAgICAgICBzZXRTZWxlY3RlZEVtZXJnZW5jeSh0cnVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g6KGM56iL5Y2V5YWz6IGU5Ye65beu55Sz6K+35Y2V5Y+3LCDkuI3lj6/mlLkKICAgICAgLy8gaWYgKHRyYXZlbE5vKSB7CiAgICAgIC8vICAgYXdhaXQgdHJhdmVsQXBwbGljYXRpb25EZXRhaWxJblRyaXBNb2RlKHRyYXZlbE5vLCBmYWxzZSkKICAgICAgLy8gICByZXR1cm4KICAgICAgLy8gfQogICAgfSBlbHNlIHsKICAgICAgLy8g5LuO57yT5a2Y5Lit5ou/5bey57uP5YWz6IGU55qE5Ye65beu55Sz6K+35Y2V5Y+35ZKM5Ye66KGM6K6h5YiS5Y+3CiAgICAgIGF3YWl0IHRyYXZlbEFwcGxpY2F0aW9uRGV0YWlsSW5TaW5nbGUodGFPcmRlck5vLCB0YVRyYXZlbFBsYW5Obyk7CiAgICB9CiAgfTsKCiAgLy8g5qCh6aqM5LiN6YCa6L+H6ZSa54K5CiAgY29uc3QgaW52YWxpZEFuY2hvciA9IChpc0FwcHJvdmFsOiBib29sZWFuLCBwcmU/OiBib29sZWFuKSA9PiB7CiAgICBjb25zdCB0aXBzID0gaXNBcHByb3ZhbAogICAgICA/IHByZQogICAgICAgID8gZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5ub1ByZUFwcHJvdmFsKQogICAgICAgIDogZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5zZWxlY3RQcmVBcHByb3ZhbCkKICAgICAgOiBnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLnNlbGVjdFRyYXZlbEFwcGxpY2F0aW9uKSB8fCAnJzsKICAgIHNldE5vU2VsZWN0ZWRUaXAodGlwcyk7CiAgICBwYXJhbXM/LmFuY2hvckhhbmRsZXIoKTsKICB9OwoKICAvLyDmoKHpqozmlrnms5UKICBjb25zdCBwb3N0QXBwcm92YWxWYWxpZEhhbmRsZXIgPSAoKSA9PiB7CiAgICAvLyDkuI3mmK/mj5DliY3lrqHmibnvvIzkuI3mmK/lrqHmibnlkI7nva7vvIzkuI3mmK/lh7rlt67nlLPor7cg5oiWIOWkmuWuoeaJueWNle+8iOS4jeWcqOatpOWkhOmAie+8iQogICAgaWYgKCghcHJlQWR2YW5jZUFwcHJvdmUgJiYgIWFkdmFuY2VBcHByb3ZlICYmICF0cmlwQXBwbHkpIHx8IG11bHRpQXBwcm92YWxNb2RlKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLy8g5o+Q5YmN5a6h5om5CiAgICBpZiAocHJlQWR2YW5jZUFwcHJvdmUpIHsKICAgICAgaWYgKHNlbGVjdGVkSXRlbT8ubm8gfHwgc2VsZWN0ZWRFbWVyZ2VuY3kpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbnZhbGlkQW5jaG9yKHRydWUsIHRydWUpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIC8vIOWuoeaJueWQjue9ruayoeacieWuoeaJueWNleWPt+aIluiAhee0p+aApemihOWumuaXtu+8jOagoemqjOS4jemAmui/hwogICAgaWYgKGFkdmFuY2VBcHByb3ZlKSB7CiAgICAgIC8v5Liq5Lq65pSv5LuY5LiN6ZyA566h5o6nIG9yIOaague8k+WHuuelqO+8jOmqjOivgem7mOiupOmAmui/hwogICAgICBpZiAoKCFwcmVBcHByb3ZlUGVyc29uICYmIHBheVR5cGUgPT09ICdQRVJTT04nKSB8fCAoaXNJbnRsICYmIHBvc3Rwb25lKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChzZWxlY3RlZEl0ZW0/Lm5vIHx8IHNlbGVjdGVkRW1lcmdlbmN5KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW52YWxpZEFuY2hvcih0cnVlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIOWHuuW3rueUs+ivt+ayoeacieWHuuW3rueUs+ivt+WNleWPt+aIluiAhee0p+aApemihOWumuaXtu+8jOagoemqjOS4jemAmui/hwogICAgaWYgKHRyaXBBcHBseSkgewogICAgICBpZiAoc2VsZWN0ZWRJdGVtPy5tYWluTm8gfHwgc2VsZWN0ZWRJdGVtPy5ubyB8fCBzZWxlY3RlZEVtZXJnZW5jeSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGludmFsaWRBbmNob3IoZmFsc2UpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CiAgLy8g5LiL5Y2V5o+Q5Lqk5pWw5o2uCiAgY29uc3Qgc3VibWl0RGF0YSA9ICgpID0+IHsKICAgIGxldCBvcmRlckRhdGEgPSB7fTsKICAgIGNvbnN0IG5ld1RyaXBBcHBseSA9IHRyaXBBcHBseSAmJiBzd2l0Y2hNYXA/Lm5ld1RyaXBBcHBseUZsYWc7CiAgICBjb25zdCBvbGRUcmlwQXBwbHkgPSB0cmlwQXBwbHkgJiYgIXN3aXRjaE1hcD8ubmV3VHJpcEFwcGx5RmxhZzsKICAgIC8vIOWuoeaJueWNlQogICAgaWYgKGFkdmFuY2VBcHByb3ZlKSB7CiAgICAgIG9yZGVyRGF0YSA9IHsKICAgICAgICBpc0VtZXJnZW5jeTogISFzZWxlY3RlZEVtZXJnZW5jeSwKICAgICAgICBhcHByb3ZhbE5vOiBzZWxlY3RlZEl0ZW0/Lm5vLAogICAgICAgIGFwcHJvdmFsTWFpbk5vOiBzZWxlY3RlZEl0ZW0/Lm1haW5ObywKICAgICAgICBtaXhQYXlLZXk6IG1peFBheUluZm8/Lm1peFBheUtleSB8fCAnJywKICAgICAgfTsKICAgICAgLy8g5paw54mI5Ye65beu55Sz6K+3CiAgICB9IGVsc2UgaWYgKG5ld1RyaXBBcHBseSkgewogICAgICBvcmRlckRhdGEgPSB7CiAgICAgICAgdHJpcEFwcGx5SW5mbzogewogICAgICAgICAgdHJpcEFwcGx5TWFpbk5vOiBzZWxlY3RlZEl0ZW0ubWFpbk5vIHx8ICcnLAogICAgICAgICAgdHJpcEFwcGx5QXBwcm92YWxObzogc2VsZWN0ZWRJdGVtLm5vIHx8ICcnLAogICAgICAgICAgdHJpcEFwcGx5RW1lcmdlbmN5OiAhIXNlbGVjdGVkRW1lcmdlbmN5LAogICAgICAgICAgbWl4UGF5S2V5OiBtaXhQYXlJbmZvPy5taXhQYXlLZXkgfHwgJycsCiAgICAgICAgfSwKICAgICAgfTsKICAgICAgLy8g5pen54mI5Ye65beu55Sz6K+3CiAgICB9IGVsc2UgaWYgKG9sZFRyaXBBcHBseSkgewogICAgICBvcmRlckRhdGEgPSB7CiAgICAgICAgaXNFbWVyZ2VuY3k6IHNlbGVjdGVkRW1lcmdlbmN5LAogICAgICAgIGVuZG9yc2VObzogc2VsZWN0ZWRJdGVtPy5tYWluTm8gfHwgJycsIC8vIOWHuuW3rueUs+ivt+WNleWPtwogICAgICAgIGRldGFpbE5vOiBTdHJpbmcoc2VsZWN0ZWRJdGVtPy5ubykgfHwgJycsIC8vIOWHuuW3rueUs+ivt+eahOWHuuihjOiuoeWIkgogICAgICAgIG1peFBheUtleTogbWl4UGF5SW5mbz8ubWl4UGF5S2V5IHx8ICcnLAogICAgICB9OwogICAgfQoKICAgIHJldHVybiBvcmRlckRhdGE7CiAgfTsKICAvLyDkuIvljZXmj5DkuqTmlbDmja4KICBjb25zdCBzdWJtaXRIYW5kbGVyID0gYXN5bmMgKG5leHQsIF8sIGVtaXRSZXEpID0+IHsKICAgIERldlRyYWNlKEZMSUdIVF9CT09LX0RFVl9MT0dfVFJBQ0VfS0VZUy5vX2NvcnBfZmx0X29yZGVyX3N1Ym1pdF9vcmRlcl9zdGFnZSwgewogICAgICBzdGFnZTogJ2dldCBtb2R1bGUgcmVxdWVzdCcsCiAgICAgIG1vZHVsZTogJ2FwcHJvdmFsJywKICAgIH0pOwogICAgdHJ5IHsKICAgICAgY29uc3QgdmFsaWQgPSBwb3N0QXBwcm92YWxWYWxpZEhhbmRsZXIoKTsKICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgIGVtaXRSZXE/LmFib3J0KHsKICAgICAgICAgIG1vZHVsZU5hbWU6ICdQb3N0QXBwcm92YWxBbmRUcmF2ZWxBcHBsaWNhdGlvbicsCiAgICAgICAgICBlcnJvck1zZzogJ3Bvc3RBcHByb3ZhbEFuZFRyYXZlbEFwcGxpY2F0aW9uIHZhbGlkYXRlIGZhaWxlZCcsCiAgICAgICAgfSk7CiAgICAgICAgZW1pdFJlcT8uaGlkZUxvYWRpbmcoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IHN1Ym1pdERhdGEoKTsKICAgICAgRGV2VHJhY2UoRkxJR0hUX0JPT0tfREVWX0xPR19UUkFDRV9LRVlTLm9fY29ycF9mbHRfYm9va19wb3N0QXBwcm92YWxfZ2V0X29yZGVyX2RhdGEsIHsKICAgICAgICB0cmlwQXBwbHksCiAgICAgICAgYWR2YW5jZUFwcHJvdmUsCiAgICAgICAgcHJlQWR2YW5jZUFwcHJvdmUsCiAgICAgICAgLi4uZGF0YSwKICAgICAgfSk7CiAgICAgIG5leHQoey4uLmRhdGF9KTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yJywgZXJyb3IpOwogICAgICBlbWl0UmVxPy5hYm9ydCh7CiAgICAgICAgbW9kdWxlTmFtZTogJ1Bvc3RBcHByb3ZhbEFuZFRyYXZlbEFwcGxpY2F0aW9uJywKICAgICAgICBlcnJvck1zZzogJ3Bvc3RBcHByb3ZhbEFuZFRyYXZlbEFwcGxpY2F0aW9uIGV4Y2VwdGlvbicsCiAgICAgIH0pOwogICAgICBlbWl0UmVxPy5oaWRlTG9hZGluZygpOwogICAgICBUcmFjZVRyeUNhdGNoKGVycm9yLCB7CiAgICAgICAgYmxvY2s6IHRydWUsCiAgICAgICAgZnVuY3Rpb25OYW1lOiAnc3VibWl0SGFuZGxlcicsCiAgICAgICAgcHJvZHVjdExpbmU6IFBST0RVQ1RfTElORSwKICAgICAgICBwYWdlTmFtZTogQk9PS19QQUdFX05BTUUsCiAgICAgIH0pOwogICAgfQogIH07CgogIC8vIOebkeWQrEBmbGlnaHQvYm9va19wYWdlX3N1Ym1pdOS6i+S7tu+8jOS8oOWFpeWbnuiwg3N1Ym1pdEhhbmRsZXIsIHJhbmtJZCwg5YW25LitcmFua0lk5Yaz5a6a5ZCE5qih5Z2X5YmN56uv5qCh6aqML+aUtumbhuWPguaVsOeahOmhuuW6jwogIHVzZUhhbmRsZUV2ZW50UmVxdWVzdChCT09LX1BBR0VfU1VCTUlULCBzdWJtaXRIYW5kbGVyLCB7cmFua0lkOiBTdWJtaXRSYW5rSWQucG9zdEFwcHJvdmFsfSk7CgogIGNvbnN0IHBvcHVwVGl0bGUgPSAoKCkgPT4gewogICAgaWYgKGJvb2tGb3JFbXBsb3llZUNvbnRyb2xDb2RlID09PSBCb29raW5nTm9uRW1wbG95ZWVFbnVtLkxDTSkgewogICAgICByZXR1cm4gZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5zZWxlY3RBcHBseSk7CiAgICB9IGVsc2UgaWYgKHRyaXBBcHBseSkgewogICAgICByZXR1cm4gZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5zZWxlY3RUcmF2ZWxBcHBsaWNhdGlvbik7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYXBwcm92YWxMaXN0VGl0bGUgfHwgZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5zZWxlY3RQcmVBcHByb3ZhbCk7CiAgICB9CiAgfSkoKTsKICByZXR1cm4gewogICAgLy8g5piv5ZCm5bGV56S65a6h5om55oiW5Ye65beu55Sz6K+35qih5Z2XKOWmguaenOaYr+WkmuWuoeaJueWNleaooeW8j++8jOWNs+aMieWHuuihjOS6uue7tOW6pumAieWuoeaJueWNle+8jOWImemakOiXj+iuouWNlee7tOW6pueahOWuoeaJueWNlSkKICAgIGlzU2hvdzogKHRyaXBBcHBseSB8fCBhZHZhbmNlQXBwcm92ZSB8fCBwcmVBZHZhbmNlQXBwcm92ZSkgJiYgIWlzTWljZSAmJiAhbXVsdGlBcHByb3ZhbE1vZGUsCiAgICBpc0xvYWRpbmc6IHJlcXVlc3RTdGF0dXMgIT09IFJlcXVlc3RTdGF0dXMuc3VjY2VzcywKICAgIC8vIOWkluaYvnRpdGxlCiAgICB0aXRsZTogdHJpcEFwcGx5CiAgICAgID8gZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy50cmF2ZWxBcHBsaWNhdGlvbkZvcm1JdGVtTGFiZWwpCiAgICAgIDogZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5mbGlnaHRBcHByb3ZhbE5vKSwKICAgIHBsZWFzZVNlbGVjdFRleHQsCiAgICAvLyDmta7lsYJ0aXRsZQogICAgcG9wdXBUaXRsZTogcG9wdXBUaXRsZSwKICAgIC8vIOa1ruWxgnRpdGxlLCDmmK/lkKbmlK/mjIHmt7fku5gsIOe6v+S4iuaYr+S7jiBnZXRFYXJpZXJBcHByb3ZlIOWPlueahAogICAgcG9wdXBTdWJUaXRsZTogYXBwcm92YWxNaXhQYXlTd2l0Y2ggPyBnZXRTaGFya1ZhbHVlKEZMSUdIVF9CT09LX1NIQVJLLmNvbXBhbnlPcGVuTWl4UGF5VGl0bGUpIDogJycsCiAgICBjYW5Nb2RpZnksCiAgICAvLyDkvb/nlKjmlrDniYjlh7rlt67nlLPor7cKICAgIG5ld1RyaXBBcHBseUZsYWc6IHN3aXRjaE1hcD8ubmV3VHJpcEFwcGx5RmxhZyB8fCBmYWxzZSwKICAgIGxpc3RQb3B1cFZpc2libGUsCiAgICBzZXRMaXN0UG9wdXBWaXNpYmxlLAogICAgdHJpcEFwcGx5LAogICAgaXNJbnRsLAogICAgc2VsZWN0ZWRJdGVtLAogICAgc2VsZWN0SXRlbUZuLAogICAgc2VsZWN0ZWRFbWVyZ2VuY3ksCiAgICBlbWVyZ2VjeVRleHQ6IGVtZXJnZW5jeU5hbWUgfHwgZ2V0U2hhcmtWYWx1ZShGTElHSFRfQk9PS19TSEFSSy5lbWVyZ2VjeSksCiAgICBvcGVuUm91dGUsCiAgICBzZWxlY3RJdGVtRm5PbGQsCiAgICByZWxhdGVkVHJhdmVsQXBwbGljYXRpb24sCiAgICBlbmRvcnNlbWVudFR5cGUsCiAgICBzZWFyY2hBcHByb3ZhbE5vTGlzdCwKICAgIG5vU2VsZWN0ZWRUaXAsCiAgICBib29rRm9yRW1wbG95ZWVDb250cm9sQ29kZSwKICAgIG5lZWROb0VtcGxveWVlOiBib29rRm9yRW1wbG95ZWVDb250cm9sQ29kZSA9PT0gQm9va2luZ05vbkVtcGxveWVlRW51bS5MQ00gPyBUX09SX0YuVCA6IFRfT1JfRi5GLAogIH07Cn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VBcHByb3ZhbFdyYXBwZXJIb29rcygpIHsKICBjb25zdCBiYXNlSW5mb0RhdGEgPSB1c2VTdWJzY3JpYmVNb2RlbDxGbGlnaHRCb29rQmFzZUluZm8+KEZMSUdIVF9CT09LX0JBU0VfSU5GT19NT0RFTCk7CiAgcmV0dXJuIHsKICAgIC8vIOWmguaenOaYr+WkmuWuoeaJueWNle+8jOWImemakOiXj+iuouWNlee7tOW6pueahOWuoeaJueWNleOAguWujOWFqOS4jea4suafk++8jOS5n+S4jeaJp+ihjGhvb2tzCiAgICBub09yZGVyQXBwcm92YWw6IGJhc2VJbmZvRGF0YT8ubXVsdGlBcHByb3ZhbE1vZGUsCiAgfTsKfQo="
}
